@page "/editUser/{UserId:int}"

@using Gimpies_Blazor1.Database.Data
@using Gimpies_Blazor1.Database.Models.Entities
@using Microsoft.EntityFrameworkCore
@inject ApplicationDbContext DbContext
@inject NavigationManager Navigation
@inject IDialogService DialogService
@rendermode InteractiveServer

<AuthorizeView Policy="@UserPolicy.Edit_Users">
    <Authorized Context="authContext">
        <h3>Medewerker bewerken</h3>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">
                @errorMessage
            </div>
        }

        @if (isDataLoaded)
        {
            @if (userToEdit != null)
            {
                <EditForm Model="@userToEdit" OnValidSubmit="HandleEditUser">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <div class="mb-3">
                        <label>Gebruikersnaam</label>
                        <InputText id="brand" class="form-control" @bind-Value="@userToEdit.Username" />
                    </div>

                    <div class="mb-3">
                        <label>Wachtwoord</label>
                        <InputText id="model" class="form-control" @bind-Value="@userToEdit.PasswordHashed" />
                    </div>

                    <div class="mb-3">
                        <label>Functie</label>
                        <InputSelect id="role" class="form-control" @bind-Value="@userToEdit.fk_UserRoleID">
                            <option value="">Selecteer een functie</option>
                            @if (roles != null)
                            {
                                @foreach (var role in roles)
                                {
                                    <option value="@role.RoleId">@role.RoleName</option>
                                }
                            }
                        </InputSelect>
                    </div>

                    <button type="submit" class="btn btn-primary">Bewerken</button>
                    <button type="button" class="btn btn-primary" @onclick="ReturnToOverview">Annuleren</button>
                </EditForm>
            }
            else
            {
                <p>Medewerker niet gevonden.</p>
            }
        }
        else
        {
            <p>De gegevens worden geladen...</p>
        }
    </Authorized>
    <NotAuthorized Context="authContext">
        <h3>Toegang Geweigerd</h3>
        <p>U heeft niet de juiste rechten om deze pagina te bekijken. Neem contact op met de beheerder als u denkt dat dit een fout is.</p>
    </NotAuthorized>
</AuthorizeView>
