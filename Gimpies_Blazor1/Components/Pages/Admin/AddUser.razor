@page "/addUser"

@using Gimpies_Blazor1.Database.Data
@using Gimpies_Blazor1.Database.Models.Entities
@using Microsoft.EntityFrameworkCore
@inject ApplicationDbContext DbContext
@inject NavigationManager Navigation
@inject IDialogService DialogService
@rendermode InteractiveServer

<PageTitle>Nieuwe medewerker toevoegen</PageTitle>

<AuthorizeView Policy="@UserPolicy.Add_Users">
    <Authorized Context="authContext">
        <h3>Medewerker toevoegen</h3>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">
                @errorMessage
            </div>
        }

        <EditForm Model="@newUser" Context="NewUser" OnValidSubmit="HandleAddUser">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-3">
                <label>Gebruikersnaam</label>
                <InputText id="username" class="form-contorl" @bind-Value="@newUser.Username" />
            </div>

            <div class="mb-3">
                <label>Wachtwoord</label>
                <InputText id="passwordhashed" class="form-contorl" @bind-Value="@newUser.PasswordHashed" />
            </div>

            <div class="mb-3">
                <label>Functie</label>
                <InputSelect id="role" class="form-control" @bind-Value="@newUser.fk_UserRoleID">
                    <option value="">Selecteer een functie</option>
                    @if (roles != null)
                    {
                        @foreach (var role in roles)
                        {
                            <option value="@role.RoleId">@role.RoleName</option>
                        }
                    }
                </InputSelect>
            </div>

            <button type="submit" class="btn btn-primary">Toevoegen</button>
            <button type="button" class="btn btn-primary" @onclick="ReturnToOverview">Annuleren</button>
        </EditForm>

    </Authorized>

    <NotAuthorized Context="authContext">
        <h3>Toegang Geweigerd</h3>
        <p>U heeft niet de juiste rechten om deze pagina te bekijken. Neem contact op met de beheerder als u denkt dat dit een fout is.</p>
    </NotAuthorized>
</AuthorizeView>
